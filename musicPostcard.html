<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
</head>

<body>
    <!-- Start overlay -->
    <div id="startOverlay" style="
        position:fixed; top:0; left:0; width:100%; height:100%;
        background:#000; color:#fff;
     display:flex; flex-direction:column;
        align-items:center; justify-content:center;
        font-family: Arial, sans-serif; z-index:9999; cursor:pointer;">

        <div style="font-size:48px; margin-bottom:20px;">üéµ</div>
        <div style="font-size:24px; margin-bottom:10px;">Tap to scan the postcard</div>
    </div>

    <a-scene mindar-image="imageTargetSrc: ./targets.mind;" vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false">

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <!-- Only status text when target found -->
        <a-entity mindar-image-target="targetIndex: 0">
            <a-text id="statusText" value="‚ô™ Playing... ‚ô™" position="0 0 0.01" align="center" color="#ffffff" width="4">
            </a-text>
        </a-entity>

        <!-- Audio element -->
        <audio id="myAudio" preload="auto">
            <source src="./dancingqueen.mp3" type="audio/mpeg">
        </audio>

        <script>
            const audio = document.getElementById('myAudio');
            const statusText = document.querySelector('#statusText');
            const overlay = document.getElementById('startOverlay');
            const target = document.querySelector('[mindar-image-target]');

            let audioEnabled = false;

            overlay.addEventListener('click', () => {
                audio.load();
                audioEnabled = true;
                overlay.style.display = 'none';
            });

            target.addEventListener('targetFound', () => {
                if (audioEnabled) {
                    audio.play().then(() => {
                        statusText.setAttribute('text', 'value: ‚ô™ Playing... ‚ô™');
                    }).catch(error => {
                        statusText.setAttribute('text', 'value: ‚ùå Play failed');
                    });
                } else {
                    statusText.setAttribute('text', 'value: Tap screen first');
                }
            });

            target.addEventListener('targetLost', () => {
                audio.pause();
            });

            audio.addEventListener('ended', () => {
                statusText.setAttribute('text', 'value: ‚ô™ Song ended ‚ô™');
            });

            audio.addEventListener('error', (e) => {
                statusText.setAttribute('text', 'value: ‚ùå Audio error');
            });
        </script>
    </a-scene>
</body>

</html>